<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Details Form</title>
    <link rel="shortcut icon" type="image/png" href="../img/icon-72x72.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-96x96.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-128x128.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-144x144.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-152x152.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-167x167.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-180x180.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-192x192.png">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
       body {
            font-family: 'Poppins', sans-serif;
            /* background: linear-gradient(135deg, #f06, #4a90e2); */
            background-image: url('https://png.pngtree.com/background/20230208/original/pngtree-beautiful-indian-wedding-background-picture-image_2026053.jpg'); 
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 160vh;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0px 10px 15px rgba(0,0,0,0.2);
            width: 400px;
        }
        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #444;
            font-weight: bold;
        }
        input[type="text"], 
        input[type="number"], 
        textarea, 
        select {
            padding: 10px;
            width: 100%;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        input:focus, 
        textarea:focus, 
        select:focus {
            border-color: #4a90e2;
            outline: none;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #f06;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #e94560;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background: #e7f3fe;
            border-left: 6px solid #2196F3;
            display: none;
        }

        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            z-index: 9999; /* Ensure it appears above other content */
            display: none; /* Hide by default */
        }

        /* Loader Text and Dots */
        .loading-text {
            font-size: 24px;
            font-family: Arial, sans-serif;
            color: white;
            margin-right: 10px;
        }

        .dots {
            display: inline-block;
        }

        .dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: white;
            border-radius: 50%;
            margin-left: 5px;
            opacity: 0;
            animation: bounce 1.4s infinite both;
        }

        .dot:nth-child(1) {
            animation-delay: 0s;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Bounce Animation for Dots */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                opacity: 0;
                transform: translateY(0);
            }
            40% {
                opacity: 1;
                transform: translateY(-10px);
            }
            60% {
                opacity: 1;
                transform: translateY(-5px);
            }
        }

        /* Button Styles */
        #loadButton {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        #loadButton:hover {
            background-color: #0056b3;
        }

       
    </style>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        // Retrieve the dynamically stored data
        const formData = sessionStorage.getItem("formData");
    
        if (formData) {
             myProfileNew = JSON.parse(formData);
           //consolelog("Received Data:", myProfileNew);
            if (myProfileNew.father_name) {
              document.getElementById("fatherName").value = myProfileNew.father_name;
          }
          if (myProfileNew.mother_name) {
            document.getElementById("motherName").value = myProfileNew.mother_name;
        }
        
        if (myProfileNew.father_ocupation) {
          document.getElementById("fatherOccupation").value = myProfileNew.father_ocupation;
      }
      if (myProfileNew.mother_occupation) {
        document.getElementById("motherOccupation").value = myProfileNew.mother_occupation;
    }
    if (myProfileNew.home_town) {
      document.getElementById("place").value = myProfileNew.home_town;
  }
  if (myProfileNew.reference) {
    document.getElementById("reference").value = myProfileNew.reference;
}
if (myProfileNew.reference_number) {
  document.getElementById("reference_number").value = myProfileNew.reference_number;
}if (myProfileNew.family_type) {
    const familyTypeDropdown = document.getElementById("familyType"); // Replace with the actual `id` of your dropdown

    // Ensure the value from myProfileNew.family_type matches the option values
    const familyTypeValue = myProfileNew.family_type;

    // Check if the value exists in the dropdown options
    const validOptions = ["Single", "Joint", "Extended", "Nuclear", "Blended"];
    if (validOptions.includes(familyTypeValue)) {
        // Set the dropdown value
        familyTypeDropdown.value = familyTypeValue;
    } else {
       //consolewarn(`Invalid family type value: ${familyTypeValue}`);
    }
} else {
   //consolelog("Family type data not found in the received data.");
}
if (myProfileNew && myProfileNew.number_of_brothers !== undefined) { // Check if `number_of_brothers` exists
    const brothersDropdown = document.getElementById("brothers");

    // Ensure the `number_of_brothers` value is valid and convert it to a string for comparison
    const brothersValue = myProfileNew.number_of_brothers.toString();

    // Check if the value matches one of the valid options
    const validOptions = ["0", "1", "2", "3", "4"];
    if (validOptions.includes(brothersValue)) {
        brothersDropdown.value = brothersValue; // Set the value
    } else {
       //consolewarn(`Invalid brothers value: ${brothersValue}`);
    }
} else {
   //consolelog("Brothers data not found in the received data.");
}
if (myProfileNew && myProfileNew.number_of_sisters !== undefined) { 
    const sistersDropdown = document.getElementById("sisters");

    // Convert 'number_of_sisters' to a string for comparison with option values
    const sistersValue = myProfileNew.number_of_sisters.toString();

    // List of valid values for the sisters dropdown
    const validOptions = ["0", "1", "2", "3", "4", "5", "6"];
    
    // Ensure the value is valid and set the corresponding option
    if (validOptions.includes(sistersValue)) {
        sistersDropdown.value = sistersValue; // Set the value
    } else {
       //consolewarn(`Invalid sisters value: ${sistersValue}`);
    }
} else {
   //consolelog("Sisters data not found in the received data.");
}
if (myProfileNew && myProfileNew.kids !== undefined) {
    const kidsDropdown = document.getElementById("kids_count");

    // Convert 'kids' to a string for comparison with option values
    const kidsValue = myProfileNew.kids.toString();

    // List of valid values for the kids dropdown
    const validOptions = ["0", "1", "2", "3", "4", "5", "6"];

    // Ensure the value is valid and set the corresponding option
    if (validOptions.includes(kidsValue)) {
        kidsDropdown.value = kidsValue; // Set the value
    } else {
       //consolewarn(`Invalid kids value: ${kidsValue}`);
    }
} else {
   //consolelog("Kids data not found in the received data.");
}
        }
      });
      
      
function set_motherTongue() {
    const defaultmothertongueId = myProfileNew.mother_tongue_id; 
      const option = document.getElementById("tongue").querySelector(`option[value="${defaultmothertongueId}"]`);
  
      if (option) {
          option.selected = true;  // Set this option as the selected one
      } else {
         //consolelog("Option not found for the given mother tongue ID.");
          }
  
  }
    </script>
</head>
<body>

<div class="container">
    <h2>Family Details</h2>
    <form id="familyForm">
        <div class="form-group" id="kids_div" style="display:none;">
            <label for="kids_count">Number of Kids</label>
            <select id="kids_count" name="kids_count" required>
              <option value="0" disabled selected hidden>Number of Kids</option>
              <option value="0">No</option>
              <option value="1">One</option>
              <option value="2">Two</option>
              <option value="3">Three</option>
              <option value="4">Four</option>
              <option value="5">Five</option>
              <option value="6">More than Five</option>
            </select>
          </div>

        <div class="form-group">
            <label for="fatherName">Father's Name:</label>
            <input type="text" id="fatherName" placeholder="Enter Father's Name" required>
        </div>
        <div class="form-group">
            <label for="fatherOccupation">Father's Occupation:</label>
            <input type="text" id="fatherOccupation" placeholder="Enter Father's Occupation" required>
        </div>
        <div class="form-group">
            <label for="motherName">Mother's Name:</label>
            <input type="text" id="motherName" placeholder="Enter Mother's Name" required>
        </div>
        <div class="form-group">
            <label for="motherOccupation">Mother's Occupation:</label>
            <input type="text" id="motherOccupation" placeholder="Enter Mother's Occupation" required>
        </div>
       
        <div class="form-group">
            <label for="brothers"> Brothers:</label>
            <select class="form-select" id="brothers" name="brothers">
                <option value="0" disabled selected hidden>Brothers</option>
                <option value="0">No</option>
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">More than Three</option>
              </select>        
        </div>
        
        <div class="form-group">
            <label for="sisters"> Sisters:</label>
            <select class="form-select mb-3 text-sign-color" id="sisters" name="sisters" >
                <option value="0" disabled selected hidden>Sisters</option>
                <option value="0">No</option>
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five</option>
                <option value="6">More than Five</option> 
            </select>       
            </div>

        <div class="form-group">
            <label for="Place">Permanent Address:</label>
            <input type="text" id="place" placeholder="Enter Your Place" required>
        </div>

        <div class="form-group">
            <label for="tongue">Mother Tongue</label>
            <select id="tongue" name="tongue" required>
                <option value="Kannada" disabled selected hidden>Mother Tongue</option>
            </select>
          </div>

        <div class="form-group">
            <label for="familyType">Family Type:</label>
            <select id="familyType" required>
                <option value="Single">Select Family Type</option>
                <option value="Single">Single</option>
                <option value="Joint">Joint</option>
                <option value="Extended">Extended</option>
                <option value="Nuclear">Nuclear</option>
                <option value="Blended">Blended</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="reference">Reference Name:</label>
            <input type="text" id="reference" placeholder="Enter Reference Name" >
        </div>
        <div class="form-group">
            <label for="reference">Reference Number:</label>
            <input type="text" id="reference_number" placeholder="Enter Reference Number" >
        </div>
        <button type="submit">Update</button>
        <div id="loader" class="loader-container">
            <div class="loading-text">Loading</div>
            <div class="dots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
        
    </form>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> 
<script>
    const marital_status = localStorage.getItem('maritalStatus');
   //consolelog(marital_status);

    // Compare as a string
    if(marital_status === '1'){ // Assuming '1' means "Not Married" and should hide kids div
      document.getElementById('kids_div').style.display = "none";
    } else {
      document.getElementById('kids_div').style.display = "block";
    }

     document.addEventListener("DOMContentLoaded", function () {
        motherTongue();
        if(localStorage.getItem('matriId')== 'NULL'||localStorage.getItem('matriId')==''||localStorage.getItem('matriId')== null ){
            logout();
        }
     });
     function logout() {
       //consolelog("User logged out");
        localStorage.clear();
        localStorage.setItem("visitedSuccessPage", "true");
        window.location.href = 'Login.html';
    }
     function motherTongue(){
      const data={
          type: "mother_tongue"
      }
      axios.post('https://www.sharutech.com/matrimony/get_data.php', data, {
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(function(response) {
           //consolelog('Success:', response.data);
            if(response.data.message.p_out_mssg_flg === 'Y'){
              const languages=response.data.dataout;
              languages.sort((a, b) => a.language.localeCompare(b.language));
              const languageSelect = document.getElementById("tongue");

              languages.forEach(language => {
                  const option = document.createElement("option");
                  option.value = language.id;
                  option.textContent = language.language;
                  languageSelect.appendChild(option);
              });
            }else{
                 //consolelog(response.data.message.p_out_mssg_flg,"and",response.data.message.p_out_mssg);
            }
            set_motherTongue();
        });
    }

    document.getElementById('familyForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent form submission

        // Get values from input fields
        const kids_count = document.getElementById('kids_count').value;
        const father_name = document.getElementById('fatherName').value;
        const father_ocupation = document.getElementById('fatherOccupation').value;
        const  mother_name = document.getElementById('motherName').value;
        const mother_occupation = document.getElementById('motherOccupation').value;
        const number_of_brothers = document.getElementById('brothers').value;
        const number_of_sisters = document.getElementById('sisters').value;
        const reference_number = document.getElementById('reference_number').value;
        const reference = document.getElementById('reference').value;
        const place = document.getElementById('place').value;
        const family_type = document.getElementById('familyType').value;
        const mother_tongue = document.getElementById('tongue').value;



        matri_id=localStorage.getItem('matriId');
        let id =localStorage.getItem('mId');

    const update = {
      "id": id,
    "matri_id": matri_id,
    "kids_count":1,
    "type":"family_details",
    "father_name": father_name,
    "mother_name": mother_name,
    "father_living_status": "0", 
    "mother_living_status": "1", 
    "number_married_brother": "0",
     "number_of_married_sister": "0",
     "mother_tongue":mother_tongue,
    "father_ocupation": father_ocupation,
    "mother_occupation": mother_occupation, 
    "number_of_brothers": number_of_brothers,
    "number_of_sisters": number_of_sisters,
    
    "reference_number": reference_number,
    "reference":reference,
    "place":place,
    "family_type": family_type
};
return axios.post('https://www.sharutech.com/matrimony/update_profile.php', update, {
  headers: {
      'Content-Type': 'application/json',
  }
})
.then(function(response) {
 //consolelog('Success:', response.data);

  if(response.data.message.p_out_mssg_flg === 'Y'){
    Swal.fire({
      title: "Success",
      text: "Success",
      icon: "Success",
      confirmButtonText: "OK",
  }).then((result) => {
    if (result.isConfirmed) {
        window.location.href = 'my_profile.html';  
    }
});
    
  window.location.href = 'my_profile.html';
  }else{
     
      
          Swal.fire({
              title: "Error!",
              text: "Failed.",
              icon: "error",
              confirmButtonText: "OK",
          });
     
      document.getElementById("loader").style.display = "none";
   //consolelog(response.data.message.p_out_mssg_flg,"and",response.data.message.p_out_mssg);
  }
});
        });

       
    

   
</script>

</body>
</html>
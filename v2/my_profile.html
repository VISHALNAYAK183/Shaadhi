<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="shortcut icon" type="image/png" href="../img/icon-72x72.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-96x96.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-128x128.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-144x144.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-152x152.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-167x167.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-180x180.png">
    <link rel="shortcut icon" type="image/png" href="../img/icon-192x192.png">
    <!-- updated for Tab space for Edit -->
<style>
/* *** GLOBAL MARGIN/PADDING RESET (AGGRESSIVE) *** */
html, body {
    padding: 0 !important; /* Force all padding to zero */
    margin: 0 !important; /* Force all margin to zero */
    box-sizing: border-box; 
    width: 100%;
    overflow-x: hidden; /* Prevents horizontal scrollbar */
    /* *** FIX: Ensure vertical scrolling on the entire page and allow collapse *** */
    overflow-y: scroll;
    min-height: 100%; /* Allow shrinking */
    height: auto;
}
/* **************************************** */


/* Default styles (for larger screens like desktops) */
#content {
    position: relative;
    z-index: 1; /* content above blur */
    overflow-y: visible; /* Let the body/document handle scrolling */
    /* üí• FIX 1: Allow content to dictate height */
    min-height: auto; 
    height: auto; 
    padding: 20px; /* Default desktop padding */
    flex: 1; 
}


#content::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    /* üí• CRITICAL FIX 2: Set height to 100% of content, not 160% */
    height: 100%;
    background: url("../img/shaadhi.png") no-repeat center center/cover;
    filter: blur(10px);
    opacity: 0.85;
    z-index: -1;
    border-radius: 10px;
}


.dashboard-content {
    position: relative;
    z-index: 2;
}

.option-button {
    padding: 8px 10px;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    background-color: #f5e7df;
    color:grey;
    transition: all 0.3s ease;
    font-weight: 500;
}

.icon-row {
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 8px 10px;
}

.icon-row1 {
    width: 100%;
    border-radius: 12px;
    border: 2px solid #f5e7df;
    background: linear-gradient(135deg, #f5e7df 0%, #f5e7df 100%);
}

.profile h2 {
    font-size: 1.8rem;
    color: #c3a38c;
    margin-bottom: 1rem;
    font-family: 'Playfair Display', serif;
}

#sidebar-placeholder {
    background: linear-gradient(180deg, #f5e7df 0%, #f5e7df 100%);
    color: #2c3e50;
    border-right: 1px solid #e3f2fd;
    /* üí• FIX 3: Allow height to collapse */
    height: auto;
    min-height: auto;
}

.sidebar {
    width: 280px;
    background: linear-gradient(180deg, #f5e7df 0%, #f5e7df 100%);
    padding: 1.5rem;
    border-right: 1px solid #e3f2fd;
    box-shadow: 4px 0 15px rgba(33, 150, 243, 0.1);
    /* üí• FIX 3: Allow height to collapse */
    height: auto;
    min-height: auto; 
    }

.profile-basic {
    max-width: 600px;
    margin: 20px auto;
    padding: 5px;
    background: #f9f9f9;
    font-family: Arial, sans-serif;
    }
    .profile-item1 {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #eee;
    }
    .profile-label1 {
    flex: 2; /* Allocates space for labels */
    font-weight: bold;
    color: #333;
    }
    .profile-item1 span {
    flex: 2; /* Allocates space for values */
    color: #555;
    text-align: left; /* Aligns values properly */
    margin-left: 20px;
    
        /* üõ†Ô∏è FIX: Prevent email/long text overflow on mobile/desktop */
        word-break: break-all;
        word-wrap: break-word;
    }
    .option-button {
    margin-bottom: 20px;
    }
    p {
    display: flex;
    align-items: center;
    }
    
    #dob {
    display: flex;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    }
    
    .option-button {
    display: flex;
    flex: 2;
    align-items: right;
    margin-left: auto; /* Pushes the button to the right */
    }


.toggle-btn {
    display: none;
}

.profile-basic {
    max-width: 600px;
    margin: 20px auto;
    padding: 5px;
    background: #f9f9f9;
    font-family: Arial, sans-serif;
}

.profile-item1 {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #eee;
}

.profile-label1 {
    flex: 2;
    font-weight: bold;
    color: #333;
}

.profile-item1 span {
    flex: 2;
    color: #555;
    text-align: left;
    margin-left: 20px;
    /* üõ†Ô∏è FIX: Prevent email/long text overflow (Redundant but keep for safety) */
    word-break: break-all; 
    word-wrap: break-word;
}

.option-button {
    margin-bottom: 20px;
}

p {
    display: flex;
    align-items: center;
}

#dob {
    display: flex;
    justify-content: space-between;
    width: 100%;
    align-items: center;
}

.option-button {
    display: flex;
    flex: 2;
    margin-left: auto;
}

/* ‚úÖ Responsive Adjustments */
@media (max-width: 768px) {
    /* 1. Reset Dashboard Container spacing and height limits */
    .dashboard-container {
        padding: 0 !important; 
        margin: 0 !important; 
        min-height: auto !important; /* *** CRITICAL FIX: Ensure collapse on mobile *** */
        height: auto !important;
        display: block; /* Ensure stacked layout for mobile */
    }
    
    /* 2. Minimized padding on the main content wrapper (#content) */
    #content {
        padding-left: 2px !important; 
        padding-right: 2px !important;
        padding-top: 40px !important; 
        min-height: auto !important; /* *** CRITICAL FIX: Collapse height to fit content *** */
        height: auto !important;
    }
    
    /* Ensure sidebar also doesn't force height on mobile */
    .sidebar, #sidebar-placeholder {
        min-height: auto !important;
        height: auto !important;
    }


    .profile-basic {
        /* 3. Force content card to use full available space */
        max-width: 100% !important; 
        padding: 5px;
        margin: 10px auto;
    }

    .profile-item1 {
        flex-direction: column; /* stack label + value */
        align-items: flex-start;
    }

    .profile-item1 span {
        margin-left: 0; /* reset margin */
        margin-top: 5px; /* add small spacing below label */
        text-align: left;
        width: 100%;
    }

    #dob {
        flex-direction: column; /* stack elements */
        align-items: flex-start;
        gap: 8px;
    }

    .option-button {
        justify-content: center; /* center buttons */
        margin-left: 0;
        margin-top: 10px;
    }
}

@media (max-width: 480px) {
    /* 1. Reset Dashboard Container spacing and height limits */
    .dashboard-container {
        padding: 0 !important;
        margin: 0 !important;
        min-height: auto !important; 
        height: auto !important;
    }
    
      /* 2. Minimized padding on the main content wrapper (#content) */
    #content {
        padding-left: 2px !important;
        padding-right: 2px !important;
        padding-top: 40px !important; 
        min-height: auto !important; /* *** CRITICAL FIX: Collapse height to fit content *** */
        height: auto !important;
    }
    
    /* Ensure sidebar also doesn't force height on mobile */
    .sidebar, #sidebar-placeholder {
        min-height: auto !important;
        height: auto !important;
    }

    .profile-basic {
        /* 3. Force content card to use full available space */
        max-width: 100% !important; 
        padding: 5px;
    }

    .profile-label1 {
        font-size: 14px;
    }

    .profile-item1 span {
        font-size: 14px;
    }

    .option-button {
        width: 100%;
        justify-content: center;
    }
}

/*shetty */
/* Base Styles */
body {
    /* The global reset at the top already sets margin: 0 */
    font-family: Arial, sans-serif;
}

.dashboard-container {
    display: flex;
    /* üí• FIX 4: Use auto-height for content-fitting height */
    min-height: auto;
    height: auto;
}

/* Sidebar */
#sidebar-placeholder {
    width: 280px;
    background: linear-gradient(180deg, #f5e7df 0%, #f5e7df 100%);
    padding: 1.5rem;
    border-right: 1px solid #e3f2fd;
    box-shadow: 4px 0 15px rgba(33, 150, 243, 0.1);
    flex-shrink: 0; 
    /* üí• FIX 4: Use auto-height for content-fitting height */
    height: auto;
    min-height: auto;
}

.sidebar {
    width: 280px;
    background: linear-gradient(180deg, #f5e7df 0%, #f5e7df 100%);
    padding: 1.5rem;
    border-right: 1px solid #e3f2fd;
    box-shadow: 4px 0 15px rgba(33, 150, 243, 0.1);
    /* üí• FIX 4: Use auto-height for content-fitting height */
    height: auto;
    min-height: auto;
}

.sidebar h3 {
    margin-top: 0;
}

/* Profile Section */
.profile-container {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.profile-left, .profile-right {
    flex: 1;
    min-width: 280px; /* mobile-friendly width */
}

/* Profile Headings */
.profile h2 {
    font-size: 1.8rem;
    color: #c3a38c;
    margin-bottom: 1rem;
}

/* Buttons */
.option-button {
    padding: 8px 10px;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    background-color: #f5e7df;
    color: grey;
    transition: all 0.3s ease;
    font-weight: 500;
    margin-bottom: 10px;
    display: inline-block;
}

/* Profile Details */
.profile-item1 {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #eee;
}

.profile-label1 {
    font-weight: bold;
    color: #333;
}

.profile-item1 span {
    color: #555;
    margin-left: 10px;
    /* üõ†Ô∏è FIX: Prevent email/long text overflow (Redundant but keep for safety) */
    word-break: break-all;
    word-wrap: break-word;
}

/* Right Section Photo */
.icon-row1 {
    width: 100%;
    border-radius: 12px;
    border: 2px solid #f5e7df;
    background: linear-gradient(135deg, #f5e7df 0%, #f5e7df 100%);
    padding: 10px;
}

.icon-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Loader */
#waiting-dialog .loader {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #c3a38c;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 2s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
}

/* Zoom Modal */
.zoom-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    padding-top: 50px;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.7);
}

.zoom-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 80%;
}

.close-zoom {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #fff;
    font-size: 40px;
    cursor: pointer;
}
.toggle-btn {
    display: none;
}
/* Responsive */
@media (max-width: 1024px) {
    .dashboard-container {
        flex-direction: column;
        /* üí• FIX 5: Use auto-height for content-fitting height */
        min-height: auto;
        height: auto;
    }
    
    #sidebar-placeholder {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #e3f2fd;
        /* üí• FIX 5: Use auto-height for content-fitting height */
        min-height: auto; 
        height: auto;
    }
    
    .profile-container {
        flex-direction: column;
    }
    
    .profile-left, .profile-right {
        min-width: 100%;
    }
}

@media (max-width: 480px) {
    .profile h2 {
        font-size: 1.4rem;
    }
    
    .option-button {
        width: 100%;
        text-align: center;
    }
    
    .profile-item1 {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .profile-item1 span {
        margin-left: 0;
        margin-top: 5px;
    }
.sidebar {
    position: fixed;
    top: 0;
    left: -220px; /* hidden by default */
    width: 220px;
    /* üí• FIX 6: Use auto-height for content-fitting height */
    height: auto; 
    background: #f5e7df;
    color: inherit;
    transition: transform 0.3s ease;
    transform: translateX(0); /* keep hidden off-screen */
    z-index: 10000; /* ensure above #content::before */
    padding: 1rem;
}

    /* When sidebar is open */
    .sidebar.open {
        left: 0;
    }

    /* Show toggle button only on small screens */
    .toggle-btn {
        display: block;
        position: fixed;
        top: 2px;
        left: 10px;
        z-index: 1100;
        background: #c3a38c;
        color: white;
        border: none;
        padding: 5px 5px;
        font-size: 20px;
        border-radius: 6px;
        cursor: pointer;
    }

    .sidebar.open h3.container-header1 {
        display: none;
    }

    .sidebar.open hr.container-header1 {
        display: none;
    }

    .sidebar.open ul {
        margin-top: 25px;
    }

    /* Optional ‚Äì prevent content shift */
    .main-content {
        margin-left: 0;
    }

}
.dashboard-container {
    max-width: 1600px;
    width: 100%;
    margin: 0 auto;
}
@media screen and (max-width: 1024px) {
    .sidebar {
        width: 200px;
    }
}

@media screen and (max-width: 768px) {
    .sidebar {
        position: fixed;
        top: 0;
        left: -220px; /* hidden by default */
        width: 220px;
        /* üí• FIX 7: Use auto-height for content-fitting height */
        height: auto; 
        background: #f5e7df;; /* adjust to your color */
        color: inherit;
        transition: transform 0.3s ease;
        transform: translateX(-5px);
        z-index: 1000;
        padding: 1rem;
    }

    /* When sidebar is open */
    .sidebar.open {
        left: 0;
    }

    /* Show toggle button only on small screens */
    .toggle-btn {
        display: block;
        position: fixed;
        top: 2px;
        left: 10px;
        z-index: 1100;
        background: #c3a38c;
        color: white;
        border: none;
        padding: 5px 5px;
        font-size: 20px;
        border-radius: 6px;
        cursor: pointer;
    }

    .sidebar.open h3.container-header1 {
        display: none;
    }

    .sidebar.open hr.container-header1 {
        display: none;
    }

    .sidebar.open ul {
        margin-top: 25px;
    }

    /* Optional ‚Äì prevent content shift */
    .main-content {
        margin-left: 0;
    }

}
/* ‚úÖ Default - Desktop view */
.options-row {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px;
    background-color: white;
    transition: all 0.3s ease-in-out;
}

/* ‚úÖ Buttons */
.option-button {
    background: #c3a38c;
    color: white;
    border: none;
    padding: 8px 14px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    transition: background 0.3s;
}

.option-button:hover {
    background: #c3a38c;
}

/* ‚úÖ Hamburger (hidden on desktop) */
.mobile-menu-icon {
    display: none;
    font-size: 24px;
    cursor: pointer;
    padding: 10px;
}

/* ‚úÖ Responsive (mobile) */
@media (max-width: 768px) {
    .mobile-menu-icon {
        display: block;
    }

    .options-row {
        display: none !important; /* hidden by default on mobile */
        flex-direction: column;
        align-items: flex-start;
        background-color: white;
        position: absolute;
        top: 55px;
        left: 10px;
        width: 200px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        z-index: 999;
    }

    .options-row.show {
        display: flex !important; /* shown when hamburger clicked */
    }
}


/* On mobile, show .profile-right above .profile-left */
@media (max-width: 768px) {
    .profile-container {
        flex-direction: column; /* stack vertically */
    }

    .profile-left {
        order: 2; /* comes after .profile-right */
    }

    .profile-right {
        order: 1; /* comes first */
        margin-bottom: 15px; /* optional spacing */
    }
}
</style>
<body>

    <div id="navbar-placeholder"></div>

    <!-- Main Layout -->
    <div class="dashboard-container">
        <!-- Sidebar -->
         <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>
        <div id="sidebar-placeholder"></div>


        <!-- Main Content Area -->
        <main id="content" class="content">
            <div id="waiting-dialog" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 9999;">
                <div style="background-color: #f5e7df; padding: 20px; border-radius: 8px;">
                    <div class="loader" style="border: 4px solid #f3f3f3; border-top: 4px solid #c3a38c; border-radius: 50%; width: 50px; height: 50px; animation: spin 2s linear infinite;"></div>
                    <p style="text-align: center; margin-top: 10px;">Please Wait...</p>
                </div>
            </div>
            
            <!-- Default Dashboard Content -->
            <section class="profile">
                <div class="profile-container">
                    <!-- Left Section -->
                    <div class="profile-left profile-details">
                        <h2><i class="fa fa-arrow-left" style="color:#c3a38c;border:1px solid black;border-radius: 50%;padding:5px;margin-right: 15px;" onclick="goBack()"></i>My Profile</h2>
                        <p><span class="labelStar"><strong>Name:</strong></span> <span id="profileNameText"></span></p>
                        <p><span class="labelStar"><strong>Age:</strong></span><span id="profileAge"></span></p>
                        <p><span class="labelStar"><strong>Height:</strong></span> <span id="profileHeight"></span></p>
                        <p><span class="labelStar"><strong>Weight:</strong></span> <span id="profileWeight"></span></p>
                        <div class="more-section" id="more">
                           
<div class="mobile-menu-icon" onclick="toggleOptions()">‚ò∞</div>

<div id="optionsRow" class="options-row">
  <button class="option-button" data-section="basic">Basic</button>
  <button class="option-button" data-section="additional">Additional</button>
  <button class="option-button" data-section="education">Education</button>
  <button class="option-button" data-section="horoscope">Horoscope</button>
  <button class="option-button" data-section="family">Family</button>
  <button class="option-button" data-section="photo">Photo</button>
  <button class="option-button" data-section="delete">Profile Status</button>
</div>

                        </div>
                        <div id="detailsSection" class="details-section profile-details">
                            <!-- Dynamic content will load here -->
                        </div>
                    </div>
                    <!-- <script>
                        
                    </script>
                     -->
                    <!-- Right Section -->
                    <div class="profile-right">
                        <!-- <hr/> -->
                        <div class="icon-row1">
                            <img id="profilePhoto" alt="User Photo" class="profile-photo">
                            <!-- </div> -->
                            <div class="icon-row">
                                <h2>Matri Id&nbsp;:&nbsp;<span id="matriText"></span></h2>

                              
                            </div>
                        </div>
                    </div>
                </div>
              

                <div id="zoomModal" class="zoom-modal" style="display: none;">
                    <div class="zoom-modal-content">
                        <span id="closeZoom" class="close-zoom">&times;</span>
                        <img id="zoomedImage" class="zoomed-image" src="" alt="Zoomed Image">
                    </div>
                </div>
            </section>
        </main>
    </div>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<script src="baseurl.js"></script>
    <script>
        function loadHTMLContent(elementId, url, callback) {
            fetch(url)
                .then(response => response.text())
                .then(data => {
                    document.getElementById(elementId).innerHTML = data;
                    if (callback) callback(); // Execute callback after content is loaded
                })
                .catch(error =>console.error('Error loading HTML:', error));
        }
        // Load Navbar and Sidebar
        loadHTMLContent('navbar-placeholder', 'navbar');
        loadHTMLContent('sidebar-placeholder', 'sidebar', function () {
            // Add event listeners after the sidebar content is loaded
            const menus = document.querySelectorAll('.matches-menu');

            menus.forEach(menu => {
                menu.addEventListener('click', function (event) {
                    // Prevent default behavior only for parent menu links
                    if (!event.target.closest('.submenu a')) {
                        event.preventDefault();
                    }

                    // Check if the clicked element has a submenu
                    const submenu = this.querySelector('.submenu');

                    // If the submenu exists, toggle its visibility
                    if (submenu) {
                        const isVisible = submenu.style.display === 'block';

                        // Close all submenus
                        document.querySelectorAll('.submenu').forEach(s => {
                            s.style.display = 'none';
                        });

                        // Toggle only the clicked submenu
                        submenu.style.display = isVisible ? 'none' : 'block';
                    }
                });
            });

            // Add listeners to submenu links to ensure navigation works
            const submenuLinks = document.querySelectorAll('.submenu a');
            submenuLinks.forEach(link => {
                link.addEventListener('click', function (event) {
                    // Allow navigation or custom logic for submenu links
                   //consolelog(`Navigating to ${this.getAttribute('href')}`);
                });
            });
        });

        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';

            // Attach a click event listener to close the dropdown when clicking outside
            if (dropdown.style.display === 'block') {
                document.addEventListener('click', closeDropdownOnClickOutside);
            }
        }

    // Close the dropdown on outside click
    function closeDropdownOnClickOutside(event) {
        const dropdown = document.getElementById('profileDropdown');
        const profileIcon = document.querySelector('.profile-icon');

        // Check if the clicked element is outside the dropdown or profile icon
        if (!dropdown.contains(event.target) && !profileIcon.contains(event.target)) {
            dropdown.style.display = 'none';
            document.removeEventListener('click', closeDropdownOnClickOutside); // Clean up the event listener
        }
    }


        function logout() {
           //consolelog("User logged out");
            localStorage.clear();
            localStorage.setItem("visitedSuccessPage", "true");
            window.location.href = 'Login';
        }
      // "More" Button Functionality

      const moreButton = document.getElementById("moreButton");
      const optionsRow = document.getElementById("optionsRow");
      const detailsSection = document.getElementById("detailsSection");

    
     document.querySelectorAll(".option-button").forEach(button => {
  button.addEventListener('click', function () {
      const section = this.getAttribute("data-section");
      loadSectionDetails(section);

      // ‚úÖ Close dropdown automatically on mobile
      const optionsRow = document.getElementById("optionsRow");
      if (window.innerWidth <= 768) {
          optionsRow.classList.remove("show");
      }
  });
});


      function toggleLike(element) {
        const icon = element.querySelector('i'); // Get the icon inside the clicked element
        
        // Toggle the classes for the heart icon
        icon.classList.toggle('fa-heart'); // Outline class
        icon.classList.toggle('fa-heart-o'); // Filled class (or vice versa)
        icon.style.color = icon.classList.contains('fa-heart-o') ? '#d0afaf' : 'red';

        // Set the color based on the toggled class
        if (icon.classList.contains('fa-heart')) {
            icon.style.color = 'red'; // If heart is filled, make it red
        } else if (icon.classList.contains('fa-heart-o')){
            icon.style.color = '#d0afaf'; // Reset the color when unliked
        }else {
            icon.style.color = '#d0afaf'; // Reset the color when unliked
        }

        // You can also set a status type if needed
        const type = icon.classList.contains('fa-heart') ? 'liked' : 'disliked';
      const data={
          "matri_id_by": localStorage.getItem('matriId'),
          "matri_id_to": localStorage.getItem("matriIdTo"),
          "type": type
      }
     //consolelog(data);
      axios.post(`${BASE_URL}/matri_liked.php`, data, {
  headers: {
    'Content-Type': 'application/json',
    "Authorization": "Bearer " + localStorage.getItem("jwtToken")
  }
})
.then(function (response) {
  // ‚úÖ Check if backend says token expired or invalid
  if (
    response.data.message?.p_out_mssg_flg === 'N' &&
    (response.data.message?.p_out_mssg?.includes('Token expired') ||
     response.data.message?.p_out_mssg?.includes('Invalid token'))
  ) {
    handleSessionExpiry();
    return;
  }

  if (response.data.message.p_out_mssg_flg === 'Y') {
    //console.log(response.data.dataout[0].viewed_count);
  } else {
    //console.log(response.data.message.p_out_mssg_flg, "and", response.data.message.p_out_mssg);
  }
})
.catch(function (error) {
  // ‚úÖ Handle unauthorized or token-related errors
  if (error.response && error.response.status === 401) {
    handleSessionExpiry();
  } else {
    Swal.fire({
      title: "Error!",
      text: "Something went wrong. Please try again.",
      icon: "error",
      confirmButtonText: "OK",
    });
  }
});

// üîπ Common session expiry handler (reusable)
function handleSessionExpiry() {
  Swal.fire({
    icon: "info",
    title: "Session Expired",
    text: "Your session has expired. Please log in again.",
    confirmButtonText: "OK",
  }).then(() => {
    localStorage.removeItem("jwtToken");
    localStorage.removeItem("matriId");
    window.location.href = "login.html";
  });
}
      }

      function contactInfoSection(){
       
            Swal.fire({
            // title: 'Creator Contact Info',
            html: `
                <h3 style="margin-bottom:10px;">Contact Information</h3>
                <div style="text-align: left;">
                <p><strong>Creator Phone No&nbsp;:</strong> ${localStorage.getItem("phone")}</p>
                <p><strong>Email Id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</strong> ${localStorage.getItem("email")}</p>
                </div>
            `,
            // icon: 'info',
            confirmButtonText: 'Close',
            confirmButtonColor: '#3085d6',
            background: '#f7f7f7',
            customClass: {
                title: 'swal-title',
                htmlContainer: 'swal-html-container',
            },
            });
        
    }

    function chatInfoSection(){
        window.location.href = "chats";
    }

    function goBack() {
                history.back();
    }

    function getPhotoHTML(photoArray) {
        return photoArray.map(photoUrl => {
            return `
                <div class="photo-item" style="position: relative; display: inline-block; margin: 10px;">
                    <img class="photo" src="${photoUrl.url}" alt="Photo" style="width: 150px; height: 150px; object-fit: cover; cursor: pointer;">
                    <div class="edit-icon" 
                         style="position: absolute; top: 5px; right: 5px; background-color: rgba(0, 0, 0, 0.6); color: white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; cursor: pointer;" 
                         onclick="showPhotoOptions('${photoUrl.sl_id}')">
                         ‚úé
                    </div>
                </div>
            `;
        }).join('');
    }
    function showPhotoOptions(photoId) {
        const popup = document.createElement('div');
        popup.style.position = 'fixed';
        popup.style.top = '50%';
        popup.style.left = '50%';
        popup.style.transform = 'translate(-50%, -50%)';
        popup.style.backgroundColor = 'white';
        popup.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
        popup.style.padding = '20px';
        popup.style.borderRadius = '8px';
        popup.style.zIndex = '1000';
    
        popup.innerHTML = `
            <p style="margin: 0 0 10px;">Choose an option:</p> 
            <button style="position: absolute; top: 5px; right: 5px; cursor: pointer; font-size: 16px;" onclick="closePopup()">‚úñ</button >           
            <button style="margin: 5px; padding: 10px; cursor: pointer;" onclick="setAsProfilePhoto('${photoId}')">Set as Profile Photo</button>
            <button style="margin: 5px; padding: 10px; cursor: pointer;" onclick="deletePhoto('${photoId}')">Delete</button>
            
        `;
    
        document.body.appendChild(popup);
    }
    
    
    img=localStorage.getItem("baseURL")
    function setAsProfilePhoto(photoId) {
        // Retrieve base URL from localStorage
       
       //consolelog('ll',photoId)
        // Extract unique sl_id for the selected photo (assume sl_id is part of photoUrl or data)
        const sl_id = photoId; // Replace with your logic to extract sl_id
        const matri_id =localStorage.getItem("matriId"); // Replace with the actual matri_id for the user
       //consolelog("m",matri_id)
        const data = {
            type: "profile",
            matri_id: matri_id,
            sl_id: sl_id
        };
       //consolelog("bhbj",data);

        call_api(data);
       
    }


    function swal_file(){
        Swal.fire({
            title: "Success!",
            text: "Profile photo updated successfully.",
            icon: "success",
            confirmButtonText: "OK"
        });


        Swal.fire({
            title: "Error!",
            text: "Failed to update profile photo.",
            icon: "error",
            confirmButtonText: "OK"
        });

    }

  async function call_api(data) {
  try {
    const token = localStorage.getItem("jwtToken");

    if (!token) {
      await handleSessionExpiry();
      return;
    }

    const response = await axios.post(`${BASE_URL}/edit_image.php`, data, {
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      }
    });

    // ‚úÖ If backend returns a new token, update it
    if (response.data && response.data.token) {
      localStorage.setItem("jwtToken", response.data.token);
    }

    // ‚úÖ Success message
    Swal.fire({
      title: "Success!",
      text: "Profile photo updated successfully.",
      icon: "success",
      confirmButtonText: "OK"
    });

    closePopup();

  } catch (error) {
    console.error("Error:", error);

    // ‚úÖ Handle unauthorized or expired session
    if (
      error.response &&
      (
        error.response.status === 401 ||
        (error.response.data && (
          error.response.data.message?.includes("expired") ||
          error.response.data.message?.includes("Invalid token")
        ))
      )
    ) {
      await handleSessionExpiry();
    } else {
      Swal.fire({
        title: "Error!",
        text: "Something went wrong. Please try again later.",
        icon: "error",
        confirmButtonText: "OK"
      });
    }
  }
}
async function handleSessionExpiry() {
  if (window.sessionExpiredAlertShown) return;
  window.sessionExpiredAlertShown = true;

  await Swal.fire({
    title: "Session Expired",
    text: "Your session has expired. Please log in again.",
    icon: "warning",
    confirmButtonText: "OK",
    allowOutsideClick: false,
    allowEscapeKey: false
  });

  localStorage.removeItem('jwtToken');
  localStorage.removeItem('matriId');
  sessionStorage.clear();

  window.location.href = "login";
}

    function deletePhoto(photoId) {
       //consolelog("Deleting photo with ID:", photoId);
    
        // Retrieve the necessary identifiers
        const matri_id = localStorage.getItem("matriId"); // Replace with the actual matri_id for the user
        const sl_id = photoId;
        // Create the payload
        const data = {
            type: "delet",
            matri_id: matri_id,
            sl_id: sl_id // Use the photoId passed to the function
        };
       //consolelog("Delete Payload:", data);
    
        // Make the API call
        call_delete_api(data);
    }
    
   async function call_delete_api(data) {
  try {
    const token = localStorage.getItem("jwtToken");

    if (!token) {
      await handleSessionExpiry();
      return;
    }

    const response = await axios.post(`${BASE_URL}/edit_image.php`, data, {
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      }
    });

    // ‚úÖ Refresh JWT token if new one is returned
    if (response.data && response.data.token) {
      localStorage.setItem("jwtToken", response.data.token);
    }

    closePopup();

    // ‚úÖ Handle success/failure message
    const msgFlag = response.data.message?.p_out_mssg_flg || "N";
    const msgText = response.data.message?.p_out_mssg || "No message returned.";

    if (msgFlag === "Y") {
      Swal.fire({
        title: "Success!",
        text: "Photo deleted successfully.",
        icon: "success",
        confirmButtonText: "OK"
      }).then(() => {
        // You can refresh gallery or remove deleted photo here
        // Example: refreshGallery();
      });
    } else {
      Swal.fire({
        title: "Error!",
        text: msgText || "Failed to delete photo.",
        icon: "error",
        confirmButtonText: "OK"
      });
    }

  } catch (error) {
    console.error("Error:", error);

    // ‚úÖ Handle token expiry / unauthorized access
    if (
      error.response &&
      (
        error.response.status === 401 ||
        (error.response.data &&
          (
            error.response.data.message?.includes("expired") ||
            error.response.data.message?.includes("Invalid token")
          )
        )
      )
    ) {
      await handleSessionExpiry();
    } else {
      Swal.fire({
        title: "Error!",
        text: "Something went wrong. Please try again later.",
        icon: "error",
        confirmButtonText: "OK"
      });
    }
  }
}

    function closePopup() {
        const popup = document.querySelector('body > div[style*="z-index: 1000"]');
        if (popup) {
            document.body.removeChild(popup);
        }
    }
        




// Function to initialize the zoom functionality
function initZoom() {
    const photos = document.querySelectorAll('.photo');
    const zoomModal = document.getElementById('zoomModal');
    const zoomedImage = document.getElementById('zoomedImage');
    const closeZoom = document.getElementById('closeZoom');

    // When any photo is clicked, show the zoomed-in version
    photos.forEach(photo => {
        photo.addEventListener('click', () => {
            zoomedImage.src = photo.src;  // Set the clicked image as the zoomed image
            zoomModal.style.display = 'flex';  // Show the modal
        });
    });

    // Close the zoom modal when the close button is clicked
    closeZoom.addEventListener('click', () => {
        zoomModal.style.display = 'none';  // Hide the modal
    });

    // Close the zoom modal when clicking anywhere outside the image
    window.addEventListener('click', (event) => {
        if (event.target === zoomModal) {
            zoomModal.style.display = 'none';  // Hide the modal if clicked outside
        }
    });
}

let myProfileNew=[];


 function myProfile() {
    const data = {
        matri_id: localStorage.getItem('matriId')
    };

    axios.post(`${BASE_URL}/my_profile.php`, data, {
        headers: {
            'Content-Type': 'application/json',
            "Authorization": "Bearer " + localStorage.getItem("jwtToken")
        }
    })
    .then(function(response) {
        const res = response.data;
 if (res.token) {
        localStorage.setItem("jwtToken", res.token);
    }
        if (res.message && res.message.p_out_mssg_flg === 'Y') {
            const myProfile = res.dataout[0];
            console.log("MY profd",myProfile);
            myProfileNew = myProfile;
  console.log("MY njfenjem",myProfileNew);
            // Update profile details safely
            document.getElementById("profileNameText").textContent =
                (myProfile.first_name && myProfile.first_name !== 'null'
                    ? myProfile.first_name + " " + myProfile.last_name
                    : '');

            document.getElementById("profileAge").textContent =
                (myProfile.age && myProfile.age !== 'null'
                    ? myProfile.age + " yrs"
                    : '');

            document.getElementById("profileHeight").textContent =
                (myProfile.height && myProfile.height !== 'null'
                    ? myProfile.height + " cm"
                    : '');

            document.getElementById("profileWeight").textContent =
                (myProfile.weight && myProfile.weight !== 'null'
                    ? myProfile.weight + " kg"
                    : '');

            // Handle profile image
            let imgURL = '';
            if (myProfile.gender_type === 'Male' && (!myProfile.url || myProfile.url === '')) {
                imgURL = '../img/2.png';
            } else if (myProfile.gender_type === 'Female' && (!myProfile.url || myProfile.url === '')) {
                imgURL = '../img/1.png';
            } else {
                imgURL = localStorage.getItem("baseURL") + myProfile.url;
            }
            document.getElementById("profilePhoto").src = imgURL;

            // Set matrimony ID
            document.getElementById("matriText").textContent = myProfile.matri_id;

        } else {
            console.error("Profile fetch failed:", res.message.p_out_mssg);
        }
    })
    .catch(function(error) {
        console.error("Error fetching profile:", error);

        // ‚úÖ Check for token-related errors
        if (
            error.response &&
            (error.response.status === 401 ||
             (error.response.data &&
              (error.response.data.message.p_out_mssg.includes("expired") ||
               error.response.data.message.p_out_mssg.includes("Invalid token"))))
        ) {
            handleSessionExpiry(); // üî• centralized session expiry handler
        } else {
            Swal.fire({
                title: "Error!",
                text: "Something went wrong while fetching profile details.",
                icon: "error",
                confirmButtonText: "OK"
            });
        }
    });
}




// Function to handle button click and display the stored value
// Function to handle radio button selection and API call

async function displayRadioButton() {
    const radios = document.getElementsByName('utrr');
    let selectedValue = 'None';

    for (let radio of radios) {
        if (radio.checked) {
            selectedValue = radio.value;
            break;
        }
    }

    const val = {
        id: localStorage.getItem('mId'),
        matri_id: localStorage.getItem('matriId'),
        status: selectedValue,
    };

    try {
        const response = await axios.post(`${BASE_URL}/profile_status.php`, val, {
            headers: {
                'Content-Type': 'application/json',
                "Authorization": "Bearer " + localStorage.getItem("jwtToken")
            }
        });

        if (response.data.message && response.data.message.p_out_mssg_flg === 'Y') {
            const profileStatus = response.data.profile_status || val.status;
            localStorage.setItem('profile_status', profileStatus);

            await Swal.fire({
                title: "Success!",
                text: "Profile status updated successfully.",
                icon: "success",
                confirmButtonText: "OK",
            });
        } else {
            await Swal.fire({
                title: "Error!",
                text: "Failed to update profile status.",
                icon: "error",
                confirmButtonText: "OK",
            });
        }
    } catch (error) {
        console.error('Error:', error);

        // ‚úÖ Use handleSessionExpiry for token errors
        if (
            error.response &&
            (error.response.status === 401 ||
                (error.response.data && (
                    error.response.data.message === "Session expired. Please log in again." ||
                    error.response.data.message.startsWith("Invalid token")
                )))
        ) {
            await handleSessionExpiry();
        } else {
            await Swal.fire({
                title: "Error!",
                text: "Failed to update profile status.",
                icon: "error",
                confirmButtonText: "OK",
            });
        }
    }
}

// Function to restore the checked state on page load
function restoreRadioButtonState() {
    const savedStatus = localStorage.getItem('profile_status');
   //consolelog('Saved Status:', savedStatus);

    const radios = document.getElementsByName('utrr');
   //consolelog('Radio buttons found:', radios.length); // This should show the actual number of radio buttons

    if (savedStatus) {
        for (let radio of radios) {
           //consolelog(`Radio value: ${radio.value}, Expected value: ${savedStatus}`);
            if (String(radio.value) === String(savedStatus)) {
                radio.checked = true;
               //consolelog(`Radio button with value ${radio.value} is now checked`);
                return; 
            }
        }
       //consolewarn('No matching radio button found for saved status:', savedStatus);
    }
}

function setDefaultRadioButton() {
    const defaultStatus = localStorage.getItem('profile_status'); // Define the default value you want (e.g., "1" for "Active")
   //consolelog("defaultStatus",defaultStatus);
    // Set the default radio button to checked
    const defaultRadio = document.querySelector(`input[name="utrr"][value="${defaultStatus}"]`);
   //consolelog("defaultStatus",defaultRadio);
    if (defaultRadio) {
        defaultRadio.checked = true;
    }

    // Optionally save the default value to localStorage
    //localStorage.setItem('profile_status', defaultStatus);
}

// Call this function when the page loads
//document.addEventListener('DOMContentLoaded', restoreRadioButtonState);

      // Function to load section details dynamically
      
      function loadSectionDetails(section) {
        
        let heightInCm = parseFloat(myProfileNew.height);

        // Convert to feet and inches
        let heightInFeet = heightInCm / 30.48;
        let feet = Math.floor(heightInFeet);
        let inches = Math.round((heightInFeet - feet) * 12);
        let profileCreator='';
      
          const sectionData = {
              basic: `
              

<div class="profile-basic">
    <button 
    class="option-button" 
    data-section="edit" 
    id="edit" 
    onClick="openPageAndPostMessage()" 
    >
    Edit
</button>
    <div class="profile-item1">
        <strong class="profile-label1">Date of Birth:</strong>
        <span id="dob">${moment(myProfileNew.dob).format("DD-MMM-YYYY")}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Phone No:</strong>
        <span id="phone">${myProfileNew.phone}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Email:</strong>
        <span id="email">${myProfileNew.email}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Profile Creator:</strong>
        <span id="profileCreator">${myProfileNew.creator_name}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Profile Created Date:</strong>
        <span id="profileCreatedDate">${moment(myProfileNew.created_date).format("DD-MMM-YYYY hh:mm:ss")}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Profile Creating For:</strong>
        <span id="profileCreatingFor">${myProfileNew.profile_for}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Profile Creating Phone:</strong>
        <span id="profileCreatingPhone">${myProfileNew.creator_phone}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Marital Status:</strong>
        <span id="maritalStatus">${myProfileNew.status}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Sub Caste:</strong>
        <span id="subCaste">${myProfileNew.sub_caste}</span>
    </div>
</div>

                `,
              additional: `
             
                    <div class="profile-basic">
                         <button 
            class="option-button" 
            data-section="edit" 
            id="edit" 
            onClick="openEditAdditional()">
            Edit
        </button>
    <div class="profile-item1">
        <strong class="profile-label1">Height:</strong>
        <span id="profileHeight">${parseInt(myProfileNew.height)+"cm"}</span>
        
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Weight:</strong>
        <span id="profileWeight">${myProfileNew.weight}Kg</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Complexion:</strong>
        <span id="profileComplexion">${myProfileNew.complexion}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Blood Group:</strong>
        <span id="profileBloodGroup">${myProfileNew.blood_group}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Disability:</strong>
        <span id="disability">${myProfileNew.disability}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Country:</strong>
        <span id="profileCountry">${myProfileNew.country}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">State:</strong>
        <span id="profileState">${myProfileNew.state}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">City:</strong>
        <span id="profileCity">${myProfileNew.city}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Address:</strong>
        <span id="profileAddress">${myProfileNew.address}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Remarks:</strong>
        <span id="profileRemarks">${myProfileNew.remark}</span>
    </div>
</div>

                `,
              education: `
                    <div class="profile-basic">
                        <button 
            class="option-button" 
            data-section="edit" 
            id="edit" 
            onClick="openEditEducation()">
            Edit
        </button>
    <div class="profile-item1">
        <strong class="profile-label1">Qualification:</strong>
        <span id="qualification1">${myProfileNew.qualification}</span>
        
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Specialization:</strong>
        <span id="specialization">${myProfileNew.specialization}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Profession:</strong>
        <span id="profession">${myProfileNew.occupation}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Company:</strong>
        <span id="company">${myProfileNew.company}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Company City:</strong>
        <span id="companyCity">${myProfileNew.company_city}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Salary:</strong>
        <span id="salaryRange">${myProfileNew.salary}</span>
    </div>
</div>

                `,
              horoscope: `
                     <div class="profile-basic">
                         <button 
            class="option-button" 
            data-section="edit" 
            id="edit" 
            onClick="openEditHoroscope()">
            Edit
        </button>
    <div class="profile-item1">
       
        <strong class="profile-label1">Nakshatra:</strong>
        <span id="nakshatra">${myProfileNew.nakshatra}</span>
        
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Rashi:</strong>
        <span id="rashi">${myProfileNew.rashi}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Gothra:</strong>
        <span id="gothra">${myProfileNew.gothra}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Birth Place:</strong>
        <span id="bplace">${myProfileNew.birth_place}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Birth Time:</strong>
        <span id="bTime">${myProfileNew.birth_time}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Family Diety:</strong>
        <span id="familyDiety">${myProfileNew.family_diety}</span>
    </div>
</div>

                `,
              family: `
                    <div class="profile-basic">
                        <button 
            class="option-button" 
            data-section="edit" 
            id="edit" 
            onClick="openEditFamily()">
            Edit
        </button>
         <div class="profile-item1">
        <strong class="profile-label1">No. of kids:</strong>
        <span id="kids">${myProfileNew.kids}</span>
        
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Father's Name:</strong>
        <span id="fatherName">${myProfileNew.father_name}</span>
        
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Father's Occupation:</strong>
        <span id="fatherOccupation">${myProfileNew.father_ocupation}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Mother's Name:</strong>
        <span id="motherName">${myProfileNew.mother_name}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Mother's Occupation:</strong>
        <span id="motherOccupation">${myProfileNew.mother_occupation}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">No of Brother's:</strong>
        <span id="brothers">${myProfileNew.number_of_brothers}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">No of Sister's:</strong>
        <span id="sisters">${myProfileNew.number_of_sisters}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Permanent Address:</strong>
        <span id="pAddress">${myProfileNew.home_town}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Mother Tongue:</strong>
        <span id="motherTongue">${myProfileNew.mother_tongue}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Family Type:</strong>
        <span id="familyType">${myProfileNew.family_type}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Reference Name:</strong>
        <span id="referenceName">${myProfileNew.reference}</span>
    </div>
    <div class="profile-item1">
        <strong class="profile-label1">Reference Number:</strong>
        <span id="referenceNumber">${myProfileNew.reference_number}</span>
    </div>
</div>

                `,
                photo: `
                <button 
            class="option-button" 
            data-section="edit" 
            id="edit" 
            onClick="openEditPhoto()">
            Upload
        </button>
                        <div class="photo-row">
                        ${getPhotoHTML(photos_url)}
                        </div>
                        `,


                
                
                    delete: `
                        <div>
                        <input type="radio" id="r1" name="utrr" value="1">
                        <label for="r1">Active</label><br><br>

                        <input type="radio" id="r2" name="utrr" value="2">
                        <label for="r2">Married</label><br><br>

                        <input type="radio" id="r3" name="utrr" value="3">
                        <label for="r3">Not Interested</label><br><br>

                        <input type="radio" id="r4" name="utrr" value="4">
                        <label for="r4">Delete</label><br><br>

                        <button class="option-button-sub" id="delete1" onclick="displayRadioButton()">Submit</button> 
                        </div>                    
                    `,
                    
                   
                    
          };
         
           
         
          detailsSection.innerHTML = sectionData[section] || "<p>No details available for this section.</p>";
              // Initialize zoom functionality after the section is loaded
            if (section === 'photo') {
                initZoom();
            }


            if (section === 'delete') {
                setDefaultRadioButton();
            }
          
        }

    // Function to update progress bar
   
    // let baseURL='';
   document.addEventListener('DOMContentLoaded', function () {
    const waitingDialog = document.getElementById('waiting-dialog');

    // ‚úÖ Logout if no valid matriId
    if (
        !localStorage.getItem('matriId') ||
        localStorage.getItem('matriId') === 'NULL' ||
        localStorage.getItem('matriId') === ''
    ) {
        logout();
        return;
    }

    // ‚úÖ Global session expiry handler
    function handleSessionExpiry(error) {
        if (
            error.response &&
            (error.response.status === 401 ||
                (error.response.data &&
                    (error.response.data.message === "Token expired" ||
                        error.response.data.message === "Invalid token" ||
                        error.response.data.message === "Authorization header missing")))
        ) {
            Swal.fire({
                title: "Session Expired",
                text: "Your session has expired. Please log in again.",
                icon: "warning",
                confirmButtonText: "OK"
            }).then(() => {
                localStorage.clear();
                window.location.href = "login.html";
            });
            return true;
        }
        return false;
    }

    // ‚úÖ Waiting dialog helpers
    function showWaitingDialog() {
        waitingDialog.style.display = 'flex';
    }
    function hideWaitingDialog() {
        waitingDialog.style.display = 'none';
    }

    // ‚úÖ Load profile section
    async function loadSectionRow() {
        document.getElementById("optionsRow").style.display = "flex";
    }

    // ‚úÖ Prepare data
    const data = {
        id: localStorage.getItem('mId'),
        matri_id: localStorage.getItem('matriId')
    };

    showWaitingDialog();

    // ‚úÖ Fetch user profile
    axios.post(`${BASE_URL}/my_profile.php`, data, {
        headers: {
            'Content-Type': 'application/json',
            "Authorization": "Bearer " + localStorage.getItem("jwtToken")
        }
    })
    .then(function (response) {
          hideWaitingDialog();
          const res = response.data;
    if (res.token) {
        localStorage.setItem("jwtToken", res.token);
    }

        if (res.message && res.message.p_out_mssg_flg === 'Y' && res.dataout && res.dataout.length > 0) {
            localStorage.setItem("matriId", response.data.dataout[0].matri_id);
            // localStorage.setItem("baseURL", response.data.my_profile[0].base_url);
            
            const image = document.getElementById("profilePicture");
            image.src = localStorage.getItem("baseURL")+response.data.dataout[0]["url"];
            const profileImg = document.getElementById("profileImg");
            profileImg.src = localStorage.getItem("baseURL")+response.data.dataout[0]["url"];
            const profileFor = document.getElementById("profileFor");
            const profileFor1 = document.getElementById("profileFor1");
            const profileId = document.getElementById("profileId");
            const profileMatriId = document.getElementById("profileMatriId");
            profileFor.textContent = response.data.dataout[0].first_name+" "+response.data.dataout[0].last_name;
            profileFor1.textContent = response.data.dataout[0].first_name+" "+response.data.dataout[0].last_name;
            profileId.textContent=response.data.dataout[0].matri_id;
            profileMatriId.textContent=response.data.dataout[0].matri_id;
           //consolelog(response.data.dataout);
                let myProfile=response.data.dataout[0];
                myProfileNew=response.data.dataout[0];
                document.getElementById("profileNameText").textContent = `${(myProfile.first_name==null || myProfile.first_name=='null')?'':myProfile.first_name+" "+myProfile.last_name}`;
                document.getElementById("profileAge").textContent = `${(myProfile.age==null || myProfile.age=='null')?'':myProfile.age+"yrs"}`;
                document.getElementById("profileHeight").textContent = `${(myProfile.height==null || myProfile.height=='null')?'': myProfile.height+"cm"}`;
                document.getElementById("profileWeight").textContent = `${(myProfile.weight==null || myProfile.weight=='null')?'':myProfile.weight+"kg"}`;
             let imgURL='';
                if(myProfile.gender_type==='Male' && (myProfile.url===null || myProfile.url==='')){
                    imgURL='../img/2.png';
                }else if(myProfile.gender_type==='Female' && (myProfile.url===null || myProfile.url==='')){
                    imgURL='../img/1.png';
                }else{  
                    imgURL=localStorage.getItem("baseURL")+myProfile.url;
                }
                document.getElementById("profilePhoto").src = imgURL;
                const matriText=document.getElementById("matriText");
                matriText.textContent=myProfile.matri_id;

            
           
            let baseURL=response.data.dataout[0].base_url;
            loadSectionRow();      

            loadSectionDetails('basic');


        } else {
            Swal.fire({
                title: "Error!",
                text: "Failed to load your profile details. Please try again later.",
                icon: "error",
                confirmButtonText: "OK"
            });
        }
    })
    .catch(function (error) {
         hideWaitingDialog(); 
        console.error("Profile fetch error:", error);
        if (!handleSessionExpiry(error)) {
            Swal.fire({
                title: "Error!",
                text: "Unable to fetch profile information.",
                icon: "error",
                confirmButtonText: "OK"
            });
        }
    })
    .finally(hideWaitingDialog);


    const photo = {
        matri_id: localStorage.getItem('matriId'),
        type: "get_image",
    };

    axios.post(`${BASE_URL}/edit_image.php`, photo, {
        headers: {
            'Content-Type': 'application/json',
            "Authorization": "Bearer " + localStorage.getItem("jwtToken")
        }
    })
    .then(function (response) {
        const res = response.data;
         if (res.token) {
        localStorage.setItem("jwtToken", res.token);
    }
        if (res.message && res.message.p_out_mssg_flg === 'Y') {
            const dataout = res.dataout || [];
            if (dataout.length > 0) {
                photos_url = dataout.map(item => ({
                    url: localStorage.getItem("baseURL") + (item.url || ""),
                    sl_id: item.sl_id || ""
                }));
            } else {
                Swal.fire({
                    title: "No Photos Found",
                    text: "Please upload your photos.",
                    icon: "info",
                    confirmButtonText: "OK"
                });
            }
        } else {
            Swal.fire({
                title: "Error!",
                text: "Failed to load profile images. Please retry.",
                icon: "error",
                confirmButtonText: "OK"
            });
        }
    })
    .catch(function (error) {
        console.error("Image fetch error:", error);
        if (!handleSessionExpiry(error)) {
            Swal.fire({
                title: "Error!",
                text: "Unable to fetch profile photos.",
                icon: "error",
                confirmButtonText: "OK"
            });
        }
    });

    // ‚úÖ Safe helper functions
    function setText(id, value) {
        const el = document.getElementById(id);
        if (el) el.textContent = value || '';
    }

    function setSrc(id, src) {
        const el = document.getElementById(id);
        if (el) el.src = src || '../img/default.png';
    }
});



</script>
<!-- <script src="rad.js"></script>   -->
</body>
</html>
